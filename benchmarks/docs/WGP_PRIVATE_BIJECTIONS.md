# Operations of Private to WGPs: The Hardware Bijection

This document details the low-level execution model of the TSFi Font System on RDNA4 architecture, specifically focusing on how the **Private Memory** and **Workgroup Processors (WGPs)** physically implement the mathematical bijections between Hilbert and Banach spaces.

The core insight is mapping the mathematical properties of the "Wave System" directly to the register hierarchy of the GPU (SGPRs vs. VGPRs).

## 1. The Register-Space Mapping

The fundamental distinction in the Fourier-G math maps perfectly to the RDNA Execution Model:

| Math Entity | Space | Variability | Hardware Resource |
| :--- | :--- | :--- | :--- |
| **State Vector** ($|\Psiangle$) | Hilbert | Constant per Glyph | **SGPR** (Scalar Registers) |
| **Basis Function** ($\phi_{nm}$) | Hilbert | Constant ROM | **L1 Cache / Constant Buffer** |
| **Coordinate** ($x, y, z$) | Banach | Variable per Lane | **VGPR** (Vector Registers) |
| **Intensity** ($I$) | Real | Computed Result | **VGPR** (Accumulator) |

### Operation A: Scalar Loading (The "True Name")
When a Workgroup is assigned to render/tessellate a glyph:
1.  **Action:** The Wavefront loads the `TSFiHilbertGlyph` coefficients from `lau_memory`.
2.  **Bijection:** Since these coefficients ($C_{nm}$) define the "Soul" of the glyph and are identical for every pixel/ray in the workgroup, they are loaded into **SGPRs**.
3.  **Benefit:** Massive register pressure reduction. We don't waste precious Vector Registers storing the font definition repeated 32/64 times.

### Operation B: Basis Synthesis (The "Manifold")
1.  **Action:** Each thread (Lane) identifies its coordinate in Banach Space ($x, y$).
2.  **Bijection:** The Basis functions ($e^{inx}$) are computed on-the-fly or loaded.
3.  **WMMA:** The hardware performs the projection $|\Psiangle 	o \langle x | \Psi angle$.
    *   **Matrix A (VGPR):** Basis Values (The location).
    *   **Matrix B (SGPR):** Coefficients (The shape).
    *   **Matrix C (VGPR):** Result (The geometry).

## 2. Private Memory & The SVDAG

The "Private" memory (Scratch/Stack) of the WGP is crucial for the **SVDAG Generation** step (Synthesis).

### Recursive Fractal Expansion
Because the Hilbert Space definition implies infinite resolution (via analytic evaluation), generating the SVDAG is a recursive process (Octree subdivision).

1.  **The Stack:** As the Compute Pipeline Thunk descends the octree to find surface boundaries, it uses **Private Memory** to maintain the traversal stack.
2.  **Symmetry Detection (The "Private" Check):**
    *   Before writing a node to global memory, the WGP checks **LDS (Local Data Share)**.
    *   **LDS as deduplication cache:** Stores hashes of the *local* sub-trees generated by this Workgroup.
    *   **Bijection:** If two branches of the Banach space have identical Hilbert sub-spectra (symmetries), they will generate identical hashes.
3.  **The Collapse:** The WGP "collapses" the tree into a DAG *locally* in LDS/Private registers before flushing to VRAM.

## 3. The "Private" Wave Function

In Quantum Mechanics, the "Collapse of the Wave Function" occurs upon observation.
In RDNA4 TSFi:
*   The **Hilbert State** (SGPRs) is the uncollapsed wave.
*   The **Private VGPRs** are the "Observers".
*   The **WMMA Instruction** is the measurement operator.

### Implementation Consequence
We must structure our Compute Pipeline Thunks such that:
*   **Divergence is minimized:** All lanes should process the same *harmonic order* ($N$) simultaneously.
*   **Vectorization is maximized:** We process 32 or 64 "Banach Points" (Vertices/Voxels) in parallel against the *single* Scalar Hilbert State.

## Summary
By treating "Private to WGP" operations as the physical manifestation of the Banach-Hilbert bijection:
1.  We utilize **Scalar Units** for the Glyph DNA (Spectrum).
2.  We utilize **Vector Units** for the Spatial Realization (Geometry).
3.  We utilize **Private/LDS** for the Topological Deduplication (SVDAG).

This ensures the hardware is fighting *with* the math, not against it.
